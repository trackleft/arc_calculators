/**
* DO NOT EDIT THIS FILE.
* See the following change record for more information,
* https://www.drupal.org/node/2815083
* @preserve
**/
(function ($, Drupal, document, once) {
  Drupal.arcGPACalculator = Drupal.arcGPACalculator || {};
  Drupal.arcGPACalculator.addCalculatorRows = function (numberOfRowsToAdd) {
    var calcTableBodyElement = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
    var currentNumRows = 0;
    if (calcTableBodyElement === null) {
      calcTableBodyElement = document.getElementById('gpa-calculator-table-body');
      if (!calcTableBodyElement) {
        console.log('No GPA Calculator Table found');
        return;
      }
      currentNumRows = calcTableBodyElement.childElementCount;
    }
    for (var i = currentNumRows; i < numberOfRowsToAdd + currentNumRows; i++) {
      var newRow = document.createElement('tr');
      var newTDNum = document.createElement('td');
      newTDNum.className = 'align-middle';
      newTDNum.innerText = i + 1;
      var newTDCourse = document.createElement('td');
      newTDCourse.innerHTML = "<input type='text' class='course-field w-100' name='course'>";
      newTDCourse.className = 'pr-2 pr-md-5';
      var newTDGrade = document.createElement('td');
      newTDGrade.innerHTML = "<select class='grade-field p-1' name='grade'><option value=''></option><option value='4'>A</option><option value='3'>B</option><option value='2'>C</option><option value='1'>D</option><option value='0'>E</option></select>";
      var newTDCredit = document.createElement('td');
      newTDCredit.innerHTML = "<input type='number' min='0' max='100' class='credit-field text-center' name='credit'>";
      newRow.appendChild(newTDNum);
      newRow.appendChild(newTDCourse);
      newRow.appendChild(newTDGrade);
      newRow.appendChild(newTDCredit);
      calcTableBodyElement.appendChild(newRow);
    }
  };
  Drupal.arcGPACalculator.calculate = function () {
    var totalUnits = 0;
    var totalGradePoints = 0;
    var firstEmptyRow = '';
    var gpaResult = '';
    var tableBody = document.getElementById('gpa-calculator-table-body');
    tableBody.childNodes.forEach(function (tableRow) {
      var courseGradeInput = tableRow.getElementsByClassName('grade-field')[0];
      var courseCreditInput = tableRow.getElementsByClassName('credit-field')[0];
      if (tableRow === tableBody.firstChild) {
        courseGradeInput.setCustomValidity('');
        courseCreditInput.setCustomValidity('');
      }
      if (courseGradeInput.value && courseCreditInput.value) {
        totalUnits += courseCreditInput.value;
        totalGradePoints += courseCreditInput.value * courseGradeInput.value;
      }
    });
    if (totalUnits) {
      gpaResult = (totalGradePoints / totalUnits).toFixed(2);
      document.getElementById('currentTermGPA').value = gpaResult;
    } else if (tableBody.firstChild.getElementsByClassName('grade-field')[0].value === '') {
      tableBody.firstChild.getElementsByClassName('grade-field')[0].setCustomValidity('Enter the grade and credits earned for at least one course.');
    } else {
      tableBody.firstChild.getElementsByClassName('credit-field')[0].setCustomValidity('Enter the grade and credits earned for at least one course.');
    }
    var prevGPAVal = document.getElementById('previousGPA').value;
    var prevCreditVal = document.getElementById('previousCredit').value;
    if (prevGPAVal && prevCreditVal) {
      totalUnits += Number(prevCreditVal);
      totalGradePoints += prevGPAVal * prevCreditVal;
      gpaResult = (totalGradePoints / totalUnits).toFixed(2);
      document.getElementById('overallGPA').value = gpaResult;
    }
  };
  Drupal.behaviors.arcGPACalculator = {
    attach: function attach(context) {
      once('gpa-calculator', document.getElementById('gpa-calculator'), context).forEach(function (calcElement) {
        var frag = new DocumentFragment();
        var addRowButton = document.createElement('button');
        addRowButton.className = 'btn btn-red mb-3';
        addRowButton.type = 'button';
        addRowButton.addEventListener('click', function () {
          Drupal.arcGPACalculator.addCalculatorRows(1);
        });
        addRowButton.title = 'Add a row to the GPA Calculator table';
        addRowButton.innerText = 'Add Row';
        frag.appendChild(addRowButton);
        var gpaCalcForm = document.createElement('form');
        gpaCalcForm.setAttribute('onsubmit', 'event.preventDefault(); return false;');
        var gpaCalcTable = document.createElement('table');
        gpaCalcTable.id = 'gpa-calculator-table';
        gpaCalcTable.className = 'table table-striped border-bottom';
        var gpaCalcTHead = document.createElement('thead');
        gpaCalcTHead.className = 'thead-dark';
        var gpaCalcTHeadTR = document.createElement('tr');
        gpaCalcTHeadTR.innerHTML = "<th scope='col'>#</th><th scope='col' class='col-6'>Course Name</th><th scope='col'>Grade</th><th scope='col' class='col-2 col-md-3'>Credits Earned</th>";
        gpaCalcTHead.appendChild(gpaCalcTHeadTR);
        gpaCalcTable.appendChild(gpaCalcTHead);
        var gpaCalcTBody = document.createElement('tbody');
        gpaCalcTBody.id = 'gpa-calculator-table-body';
        Drupal.arcGPACalculator.addCalculatorRows(6, gpaCalcTBody);
        gpaCalcTable.appendChild(gpaCalcTBody);
        gpaCalcForm.appendChild(gpaCalcTable);
        var calcCurrentTermGPARow = document.createElement('div');
        calcCurrentTermGPARow.className = 'form-group row mx-0';
        calcCurrentTermGPARow.innerHTML = "<label for='currentTermGPA' class='col-form-label pr-3 font-weight-bold'>Current Term GPA:</label><input type='text' class='form-control w-auto' size='8' id='currentTermGPA' readonly=''>";
        gpaCalcForm.appendChild(calcCurrentTermGPARow);
        var calcPreviousInputRow = document.createElement('div');
        calcPreviousInputRow.className = 'form-row';
        var gpaCalcPrevGPA = document.createElement('div');
        gpaCalcPrevGPA.className = 'form-group col-12 col-md-4';
        gpaCalcPrevGPA.innerHTML = "<label for='previousGPA'>Previous Cumulative GPA</label><input type='text' class='form-control' id='previousGPA' pattern='^\\d*(\\.\\d{0,2})?$' aria-describedby='previousGPAHelp'><small id='previousGPAHelp' class='form-text text-muted'>Current GPA</small>";
        calcPreviousInputRow.appendChild(gpaCalcPrevGPA);
        var gpaCalcPrevCredit = document.createElement('div');
        gpaCalcPrevCredit.className = 'form-group col-12 col-md-4';
        gpaCalcPrevCredit.innerHTML = "<label for='previousCredit'>Previous Cumulative Credits Earned</label><input type='text' class='form-control' id='previousCredit' pattern='^\\d*$' aria-describedby='previousCreditHelp'><small id='previousCreditHelp' class='form-text text-muted'>Your total graded units (credit hours)</small>";
        calcPreviousInputRow.appendChild(gpaCalcPrevCredit);
        gpaCalcForm.appendChild(calcPreviousInputRow);
        var calcOverallGPARow = document.createElement('div');
        calcOverallGPARow.className = 'form-group row mx-0';
        calcOverallGPARow.innerHTML = "<label for='overallGPA' class='col-form-label pr-3 font-weight-bold'>Overall GPA:</label><input type='text' class='form-control w-auto' size='8' id='overallGPA' readonly=''>";
        gpaCalcForm.appendChild(calcOverallGPARow);
        var calcButton = document.createElement('button');
        calcButton.className = 'btn btn-red mb-3';
        calcButton.type = 'submit';
        calcButton.addEventListener('click', function () {
          Drupal.arcGPACalculator.calculate();
        });
        calcButton.title = 'Calculate ';
        calcButton.innerText = 'Calculate';
        gpaCalcForm.appendChild(calcButton);
        frag.appendChild(gpaCalcForm);
        calcElement.appendChild(frag);
        var prevGPA = document.getElementById('previousGPA');
        prevGPA.addEventListener('input', function () {
          if (prevGPA.validity.patternMismatch) {
            prevGPA.setCustomValidity('Please enter a number value for your GPA.');
          } else {
            prevGPA.setCustomValidity('');
          }
        });
        var prevCredit = document.getElementById('previousCredit');
        prevCredit.addEventListener('input', function () {
          if (prevCredit.validity.patternMismatch) {
            prevCredit.setCustomValidity('Please enter your number of credit hours.');
          } else {
            prevCredit.setCustomValidity('');
          }
        });
      });
    }
  };
})(jQuery, Drupal, this.document, once);